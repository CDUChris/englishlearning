{"version":3,"file":"src_app_login_login_module_ts.js","mappings":"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","sources":["./src/app/login/login-routing.module.ts","./src/app/login/login.module.ts","./src/app/login/login.page.ts","./src/app/utils/fbui.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { LoginPage } from './login.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: LoginPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class LoginPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { LoginPageRoutingModule } from './login-routing.module';\n\nimport { LoginPage } from './login.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    LoginPageRoutingModule\n  ],\n  declarations: [LoginPage]\n})\nexport class LoginPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { NavController } from '@ionic/angular';\nimport { AppConfig } from '../app.config';\nimport { AppNet } from '../app.net';\nimport { PageBase } from '../app.page';\nimport { AppStore } from '../app.store';\nimport { AngularFireAuth } from '@angular/fire/compat/auth';\nimport { getAuth, RecaptchaVerifier } from '@angular/fire/auth';\nimport { firebaseUIInit } from '../utils/fbui';\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.page.html',\n  styleUrls: ['./login.page.scss'],\n})\nexport class LoginPage extends PageBase implements OnInit {\n  form = {\n    phone: '+61450431269',\n    code: '',\n  };\n  confirmationResult: any;\n\n  constructor(\n    protected appStore: AppStore,\n    protected navCtrl: NavController,\n    public route: ActivatedRoute,\n    public auth: AngularFireAuth\n  ) {\n    super(appStore, navCtrl, route);\n  }\n  ngOnInit(){}\n \n\n  ionViewWillEnter() {\n    firebaseUIInit('#loginContainer', this);\n  }\n\n  onLoginUserinfo(user) {\n    this.doLogin(user.phoneNumber, user, '11111111111111');\n  }\n\n  async onSignIn() {\n    if (this.form.phone == '1234') {\n      this.mockLogin();\n      return;\n    }\n\n    if (!this.confirmationResult) {\n      alert('Please click send sms');\n      return;\n    }\n    let code = this.form.code;\n    code = code.replace(/\\s+/gi, '');\n    if (code.length < 6) {\n      alert('Input valid value');\n      return;\n    }\n\n    try {\n      const userCred = await this.confirmationResult.confirm(code);\n      if (userCred == null) {\n        this.confirmationResult = null;\n        alert('sign in fail');\n        return;\n      }\n      const userCredClone = this.copy(userCred);\n      console.log('userCredClone', this.json(userCredClone));\n      this.doLogin(\n        this.form.phone,\n        userCredClone.user,\n        userCredClone.credential\n      );\n    } catch (e) {\n      this.confirmationResult = null;\n      alert(e.toString());\n    }\n  }\n\n  async onTest() {\n    const str =\n      '{\"uid\":\"ea67mwX9s6Mkff2zZupS1JACyz92\",\"emailVerified\":false,\"isAnonymous\":false,\"phoneNumber\":\"+61481778483\",\"providerData\":[{\"providerId\":\"phone\",\"uid\":\"+61481778483\",\"displayName\":null,\"email\":null,\"phoneNumber\":\"+61481778483\",\"photoURL\":null}],\"stsTokenManager\":{\"refreshToken\":\"AOEOulZ_P33ZQOlSrySuSgVHKZqI2Ofn-w4yoKX3ohahdTrKMJlxWbYnOrNWXiBj1YqfDSHmtvZNTBq0YJxGQwUqjEVr3nNFxA4vkzmWPBa5twwqGXsMp3F6Npi0sY7jDlRBnm5N5BOH0hQJ-z6CWV9Wky_eEOzOKQs4DN6wSe9jxSarOSVmMEZ50_wryTayXNaKX7STNG7wHoo-Wkv1V5YfwAhZi-By0A\",\"accessToken\":\"eyJhbGciOiJSUzI1NiIsImtpZCI6IjVkMzQwZGRiYzNjNWJhY2M0Y2VlMWZiOWQxNmU5ODM3ZWM2MTYzZWIiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vbWFuZGFyaW5nYXRoZXJpbmctZDkxZDQiLCJhdWQiOiJtYW5kYXJpbmdhdGhlcmluZy1kOTFkNCIsImF1dGhfdGltZSI6MTY2NTk5NTYxMiwidXNlcl9pZCI6ImVhNjdtd1g5czZNa2ZmMnpadXBTMUpBQ3l6OTIiLCJzdWIiOiJlYTY3bXdYOXM2TWtmZjJ6WnVwUzFKQUN5ejkyIiwiaWF0IjoxNjY1OTk1NjEyLCJleHAiOjE2NjU5OTkyMTIsInBob25lX251bWJlciI6Iis2MTQ4MTc3ODQ4MyIsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsicGhvbmUiOlsiKzYxNDgxNzc4NDgzIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGhvbmUifX0.xtoyiPLx4VDLCWarKAdTs8raU3JiFmkdR1USe__O2TckYXIQrZurYqkPow4csYesQ6TE0NiG3NUSreMNqerXwUctP3IRHmweIMbdGskv-CNrgWTC6Pb94fLgiK5yerMgjbA8-md6rpzzRgyiRgfeD_ePXMR7OqBaI8fQ3kL3OTrTprSmcK2e7mXVnxo0jT0SP38rYVoY4hMxLXMWDIfRsTgZGi3HynjutOGDc_l8cUitY0CZnLoMZoDuSlOSk78gPJ_wiFgR2Tk6kZzpsncV7gghtYMrqpKyqbIpXBlWg2nUWxO49Zpp_8oosucmi27XGNzFfp__Jvkhl5c28UXI5A\",\"expirationTime\":1665999212267},\"createdAt\":\"1665290970828\",\"lastLoginAt\":\"1665995611990\",\"apiKey\":\"AIzaSyDhuDC4kWZvwrpr-3ueD5qRCvlufpy6z2I\",\"appName\":\"[DEFAULT]\"}';\n\n    const user = JSON.parse(str);\n    console.log(user);\n    this.doLogin(this.form.phone, user, '#11111111');\n  }\n\n  async onSendSMS() {\n    let phone = this.form.phone;\n    phone = phone.replace(/\\s+/gi, '');\n    if (phone.length < 4) {\n      alert('Please input valid value');\n      return;\n    }\n\n    if (phone == '1234') {\n      this.mockLogin();\n      return;\n    }\n\n    const auth = getAuth();\n    const recaptchaVerifier = new RecaptchaVerifier(\n      'signInMessage',\n      {\n        size: 'invisible',\n        callback: (response) => {\n          console.log('sign in response:', this.json(response));\n        },\n      },\n      auth\n    );\n\n    try {\n      this.confirmationResult = await this.auth.signInWithPhoneNumber(\n        phone,\n        recaptchaVerifier\n      );\n    } catch (e) {\n      this.confirmationResult = null;\n      alert(e.toString());\n    }\n  }\n\n  async doLogin(phone, user, credential) {\n    if (credential) {\n      await AppConfig.setSessToken({ token: credential.toString() });\n    }\n    user = this.copy(user);\n\n    await AppConfig.setSession(user);\n    await AppConfig.set('loginAccount', phone);\n    console.log('#aabb', user);\n\n    this.appStore.update((state) => ({\n      sess: AppConfig.$session,\n      isLogin: AppConfig.isLogin(),\n    }));\n\n    console.log('#3333');\n    this.hrefReplace('/folder/Inbox');\n    await this.toast('Successful');\n  }\n\n  async mockLogin() {\n    this.doLogin('123456789123', { uid: '1234' }, '11111111111111');\n  }\n}\n","import firebase from 'firebase/compat/app';\nimport * as firebaseui from 'firebaseui';\n\nlet oberserve: any = null;\n\nfunction getUiConfig() {\n  return {\n    callbacks: {\n      // Called when the user has been successfully signed in.\n      signInSuccessWithAuthResult: function (authResult, redirectUrl) {\n        if (authResult.user) {\n          handleSignedInUser(authResult.user);\n        }\n        if (authResult.additionalUserInfo) {\n          document.getElementById('is-new-user').textContent = authResult\n            .additionalUserInfo.isNewUser\n            ? 'New User'\n            : 'Existing User';\n        }\n        // Do not redirect.\n        return false;\n      },\n    },\n    // Opens IDP Providers sign-in flow in a popup.\n    signInFlow: 'popup',\n    signInOptions: [\n      {\n        provider: firebase.auth.PhoneAuthProvider.PROVIDER_ID,\n        defaultCountry: 'AU',\n        recaptchaParameters: {\n          size: 'invisible',\n        },\n      },\n    ],\n    // Terms of service url.\n    tosUrl: 'https://www.google.com',\n    // Privacy policy url.\n    privacyPolicyUrl: 'https://www.google.com',\n    credentialHelper: firebaseui.auth.CredentialHelper.NONE,\n  };\n}\n\n// Initialize the FirebaseUI Widget using Firebase.\nconst ui = new firebaseui.auth.AuthUI(firebase.auth());\nui.disableAutoSignIn();\n\n/**\n * Displays the UI for a signed in user.\n * @param {!firebase.User} user\n */\nexport const handleSignedInUser = (user) => {\n  console.log('login', JSON.stringify(user));\n  if(user && oberserve && oberserve.onLoginUserinfo) {\n    oberserve.onLoginUserinfo(user);\n  }\n  /// .........\n};\n\n/**\n * Displays the UI for a signed out user.\n */\nexport const handleSignedOutUser = () => {\n  // console.log('logout');\n  // ...\n};\n\n// Listen to change in auth state so it displays the correct UI for when\n// the user is signed in or not.\nfirebase.auth().onAuthStateChanged((user) => {\n  // document.getElementById('loading').style.display = 'none';\n  // document.getElementById('loaded').style.display = 'block';\n  user ? handleSignedInUser(user) : handleSignedOutUser();\n});\n\n\n/**\n * Handles when the user changes the reCAPTCHA, email signInMethod or email\n * disableSignUp config.\n */\nfunction handleConfigChange() {\n  console.log('config change...');\n  ui.reset();\n  ui.start('#firebaseui-container', getUiConfig());\n}\n\n/**\n * Initializes the app.\n */\nexport const firebaseUIInit =  (container: string, ob: any) => {\n  ui.start(container, getUiConfig());\n  oberserve = ob;\n};\n\n"],"names":[],"sourceRoot":"webpack:///"}