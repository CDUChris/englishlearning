{"version":3,"file":"src_app_conversation_conversation_module_ts.js","mappings":"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","sources":["./src/app/conversation/conversation-routing.module.ts","./src/app/conversation/conversation.module.ts","./src/app/conversation/conversation.page.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ConversationPage } from './conversation.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ConversationPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ConversationPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ConversationPageRoutingModule } from './conversation-routing.module';\r\n\r\nimport { ConversationPage } from './conversation.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ConversationPageRoutingModule\r\n  ],\r\n  declarations: [ConversationPage]\r\n})\r\nexport class ConversationPageModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { PageBase } from '../app.page';\r\nimport { AppStore } from '../app.store';\r\nimport { LoadingController, NavController, ToastController } from '@ionic/angular';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { getStorage, ref, listAll } from \"firebase/storage\";\r\nimport { uploadBytes } from '@firebase/storage';\r\nimport { Router } from '@angular/router';\r\n\r\n@Component({\r\n  selector: 'app-conversation',\r\n  templateUrl: './conversation.page.html',\r\n  styleUrls: ['./conversation.page.scss'],\r\n})\r\nexport class ConversationPage extends PageBase implements OnInit {\r\n\r\n  conversations = []\r\n  conversationsSource = []\r\n\r\n  constructor(\r\n    protected appStore: AppStore,\r\n    protected navCtrl: NavController,\r\n    public route: ActivatedRoute,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController,\r\n    private router:Router\r\n  ) {\r\n    super(appStore, navCtrl, route);\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.fetchConversations()\r\n  }\r\n\r\n  async fetchConversations() {\r\n\r\n    // Create a reference to the file we want to download\r\n    const storage = getStorage();\r\n\r\n    // Get the download URL\r\n    const listRef = ref(storage, 'conversations');\r\n\r\n    // Find all the prefixes and items.\r\n    listAll(listRef)\r\n      .then((res) => {\r\n        this.conversations = this.conversationsSource = res.prefixes.map(item => ({ title: item.name,remembered:localStorage.getItem(`conversation${item.name}`) }));\r\n      }).catch((error) => {\r\n        // Uh-oh, an error occurred!\r\n      });\r\n  }\r\n\r\n  async showLoading() {\r\n    const loading = await this.loadingController.create({\r\n      message: '上传中...',\r\n    });\r\n\r\n    await loading.present();\r\n  }\r\n  async hideLoading() {\r\n    await this.loadingController.dismiss();\r\n  }\r\n\r\n  async addFileChange(event) {\r\n    this.showLoading();\r\n    const file = event.target.files[0];\r\n    const fileName = file.name;\r\n    const fielFloderName = fileName.slice(0, fileName.lastIndexOf('.'));\r\n\r\n    const storage = getStorage();\r\n    const storageRef = ref(storage, 'conversations/' + fielFloderName + '/' + fileName);\r\n\r\n    // 'file' comes from the Blob or File API\r\n    uploadBytes(storageRef, file).then(async (snapshot) => {\r\n      await this.hideLoading();\r\n      const toast = await this.toastController.create({\r\n        message: 'Upload success',\r\n        duration: 1500,\r\n        position: 'middle'\r\n      });\r\n      await toast.present();\r\n      this.fetchConversations();\r\n    });\r\n\r\n  }\r\n\r\n  onInputChange(e) {\r\n    const { value } = e.detail || {};\r\n    this.conversations = this.conversationsSource.filter((conversation) => conversation.title.indexOf(value) != -1)\r\n  }\r\n\r\n  \r\n  onCheckboxChange(conversation,e){\r\n    const { title } = conversation;\r\n    const { detail: { checked } } = e;\r\n    if (checked) {\r\n      localStorage.setItem(`conversation${title}`, '1');\r\n    } else {\r\n      localStorage.removeItem(`conversation${title}`);\r\n    }\r\n  }\r\n\r\n  onCheckBoxClick(e){\r\n    e.stopPropagation()\r\n  }\r\n  onBack(){\r\n    // this.location.back()\r\n    this.router.navigate(['folder/Inbox'])\r\n  }\r\n\r\n}\r\n"],"names":[],"sourceRoot":"webpack:///"}